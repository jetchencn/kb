
**发票在数据仓库中通常建模为“事实表”**，采用**星形模型**或**雪花模型**，具体取决于业务需求。用一句话概括：**发票是记录交易事实的“收据核心”，关联客户、产品、税务等维度表，形成可分析的交易网络**。

---

### **示例：销售发票模型拆解**
#### 1️⃣ **事实表（记录交易核心）**
| 发票ID  | 开票日期ID | 客户ID | 产品ID | 数量 | 单价 | 含税金额 | 税率 | 付款状态 |  
|---------|------------|--------|--------|------|------|----------|------|----------|  
| F202310001 | 20231015 | KH2001 | P5002 | 100  | 80   | 8,480    | 6%   | 已付     |  

#### 2️⃣ **维度表（解释交易背景）**
- **客户维度表**  
  | 客户ID | 客户名称   | 行业     | 纳税人类型 |  
  |--------|------------|----------|------------|  
  | KH2001 | 蓝天科技   | 制造业   | 一般纳税人 |  

- **产品维度表**  
  | 产品ID | 产品名称   | 分类     | 单位 |  
  |--------|------------|----------|------|  
  | P5002  | 精密轴承   | 机械配件 | 个   |  

- **时间维度表**  
  | 日期ID   | 日期        | 年份 | 季度 | 月份 |  
  |----------|-------------|------|------|------|  
  | 20231015 | 2023-10-15  | 2023 | Q4   | 10   |  

- **税务维度表**（特殊设计）  
  | 税率ID | 税率值 | 适用地区 | 政策依据 |  
  |--------|--------|----------|----------|  
  | T006   | 6%     | 全国     | 增值税政策 |  

---

### **3秒理解关键点**  
1. **发票即交易事实**：核心记录**数量、单价、金额、税率**等数值  
2. **维度表解释“谁、何时、何物”**：客户说明买方，产品说明卖什么，时间说明交易时点  
3. **状态跟踪**：付款状态（如“已付/未付/逾期”）支持资金流分析  

---

### **发票模型的两种典型设计**  
#### **场景1：星形模型（简单高效）**  
- **结构**：  
  ```
  ★ 发票事实表  
  ├── 客户维度表  
  ├── 产品维度表  
  ├── 时间维度表  
  └── 税务维度表  
  ```  
- **适用场景**：  
  - 快速分析“2023年制造业客户开票金额Top10”  
  - 查询时只需关联4张表，响应速度快  

#### **场景2：雪花模型（复杂维度）**  
- **结构**：  
  ```
  ★ 发票事实表  
  ├── 客户维度表 → 行业子表  
  ├── 产品维度表 → 分类子表  
  ├── 时间维度表 → 季度子表  
  └── 税务维度表 → 政策依据子表  
  ```  
- **适用场景**：  
  - 分析“不同行业适用的税率分布”  
  - 需要多层关联，但存储更节省（如政策依据文本只存一次）  

---

### **发票的特殊性**  
1. **多行明细**：一张发票可能包含多个商品（需设计**发票行项目事实表**）  
   | 行ID | 发票ID  | 产品ID | 数量 | 单价 | 金额 |  
   |------|---------|--------|------|------|------|  
   | 1    | F202310001 | P5002 | 50   | 80   | 4,000 |  
   | 2    | F202310001 | P5003 | 50   | 80   | 4,000 |  

2. **税务合规性**：需关联税率、发票类型（普票/专票）、红蓝字标识  
3. **生命周期跟踪**：  
   - 开票 → 寄送 → 签收 → 付款 → 作废（需用**状态维度表**或时间戳字段）  

---

### **典型分析场景**  
1. **收入确认**：  
   “按季度统计已开票但未付款的金额” → 关联发票事实表+时间维度表，筛选付款状态为“未付”  
2. **税务优化**：  
   “不同税率产品的销售额占比” → 按税率维度聚合金额  
3. **客户分析**：  
   “TOP10客户的开票金额 vs 实际回款周期” → 关联发票事实表+客户维度表+付款计划事实表  

---

### **类比理解**  
- **发票事实表**像**超市购物小票**：  
  核心记录买了什么、多少钱，但商品详情（产地、分类）需要查商品手册（维度表）。  
- **多行发票**像**网购订单**：  
  一个订单ID下包含多件商品，每件商品独立记录数量和价格。  

---

### **发票 vs 财务凭证**  
|              | **发票模型**                 | **财务凭证模型**             |  
|--------------|------------------------------|------------------------------|  
| **核心目的** | 记录交易细节（对外）         | 记录会计分录（对内）         |  
| **金额设计** | 含税金额、税率               | 借贷双向金额（必须平衡）     |  
| **关联方**   | 客户（买方）                 | 部门/项目（成本中心）        |  
| **法律效力** | 具有税务凭证属性             | 企业内部核算依据             |  

**总结**：发票是**面向交易的星形模型事实表**，既支持业务分析（客户消费行为），也满足合规需求（税务审计）。